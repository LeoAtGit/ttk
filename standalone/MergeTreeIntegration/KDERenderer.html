<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Donut And Streamgraphs</title>
    <script type="text/javascript" src="../WebSocketIO/ttkWebSocketIO.js"></script>
    <script type="text/javascript" src="./KDERenderer.js"></script>
    <script type="text/javascript" src="./TreeRenderer.js"></script>
    <script type="text/javascript" src="./GraphOptions.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="KDERenderer.css" />


    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.3.0/d3.min.js" integrity="sha512-NMhzM2RHzbCRO0s5VPaRC+2bW6nmNXimzC9p5sp2x19M+zzuSJ2T50dEQ7hpHkNjnX1mt8nQg1NNthwRZgsoIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r117/three.min.js"></script>
  </head>
    <body>

    <div class="container">
      <!-- "Header" with Graph Options -->
      <div id="div_graph_options" class="row">

        <div style="width: 200px">
          <div class="row align-items-center px-1 pad-top-bottom">
            <label style="width: 90px">Color Scheme</label>
            <select id="color_scheme" style="width: 90px">
              <option value="schemeSet3">schemeSet3</option>
              <option value="schemePaired">schemePaired</option>
              <option value="schemeSet1">schemeSet1</option>
            </select>
          </div>
        </div>

        <div style="width: 5px; padding: 0;">|</div>

        <div style="width: 200px">
          <div class="row align-items-center px-1 pad-top-bottom">
            <label class="col-4">Top N</label>
            <input id="topN" class="col-6" type="range" min="1" max="6" value="3">
            <label id="label_topN" class="col-2" for="topN"></label>
          </div>
        </div>

        <div style="width: 5px; padding: 0;">|</div>

        <div style="width: 250px">
          <div class="row align-items-center px-1 pad-top-bottom">
            <label class="col-5">Top N Map</label>
            <input id="topN_map" class="col-5" type="range" min="0" max="4" value="0">
            <label id="label_topN_map" class="col-2" for="topN"></label>
          </div>
        </div>

        <div style="width: 5px; padding: 0;">|</div>

        <div style="width: 300px">
          <div class="row align-items-center px-1 pad-top-bottom">
            <label style="width: 90px">Graph Type</label>
            <select id="graph_type" style="width: 180px">
              <option value="streamgraph_abs">Streamgraph (absolute)</option>
              <option value="streamgraph_rel">Streamgraph (relative)</option>
              <option value="donut">Donut</option>
              <option value="pie">Pie Chart</option>
            </select>
          </div>
        </div>

        <div style="width: 5px; padding: 0;">|</div>

        <div style="width: 250px">
          <div class="row align-items-center px-1 pad-top-bottom">
            <label style="width: 90px">Graph Scale</label>
            <input id="graphScale" style="width: 100px" type="range" min="1" max="100" value="50">
            <label id="label_graphScale" style="width: 30px" for="graphScale"></label>
          </div>
        </div>

        <div style="width: 5px; padding: 0;">|</div>

        <div style="width: 250px">
          <div class="row align-items-center px-1 pad-top-bottom">
            <label style="width: 90px">Tree Scale</label>
            <input id="treeScale" style="width: 100px" type="range" min="25" max="400" value="50">
            <label id="label_treeScale" style="width: 30px" for="treeScale"></label>
          </div>
        </div>

        <div style="width: 5px; padding: 0;">|</div>

        <div id="more_toggle" style="width: 5px; cursor: pointer">...</div>

        <div class="more" style="width: 5px">|</div>

        <div class="more" style="width: 200px">
          <div class="row align-items-center px-1 pad-top-bottom">
            <label class="col-4">No. of Contours</label>
            <input id="contour_count" class="col-6" type="range" min="1" max="10" value="3">
            <label id="label_contour_count" class="col-2" for="contour_count"></label>
          </div>
        </div>

        <div class="more" style="width: 5px">|</div>

        <div class="more" style="width: 200px">
          <div class="row align-items-center px-1 pad-top-bottom">
            <label class="col-4">Hatching Count</label>
            <input id="hatching_count" class="col-6" type="range" min="1" max="10" value="3">
            <label id="label_hatching_count" class="col-2" for="hatching_count"></label>
          </div>
        </div>

        <div class="more" style="width: 5px">|</div>

        <div class="more" style="width: 200px">
          <div class="row align-items-center px-1 pad-top-bottom">
            <label class="col-4">Hatching Width</label>
            <input id="hatching_width" class="col-6" type="range" min="1" max="10" value="3">
            <label id="label_hatching_width" class="col-2" for="hatching_width"></label>
          </div>
        </div>

        <div class="row" style="height: 10px"></div>

        <!-- Map and Graphs -->
        <div class="row">
          <div class="col-5">
            <div class="row">
              <div id="mapContainer" class="col-12"></div>
              <div id="legend_div">
                <div class="row align-items-center px-1">
                  <div id="color_legend">
                    <h5>Gangs</h5>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div id="graphContainer" class="col-7">
            <div id="graph" class="row">
              <div id="treeContainerDonut"></div>
              <div id="treeContainerPie"></div>
              <div id="treeContainerStreamgraphAbs"></div>
              <div id="treeContainerStreamgraphRel"></div>
            </div>
          </div>
        </div>
      </div>

    </div>

      <script id='sourceCode'>
const map = L.map('mapContainer').setView([41.85003, -87.65005], 13);
const mapLink = '<a href="https://openstreetmap.org">OpenStreetMap</a>';
const translink = '<a href="http://thunderforest.com/">Thunderforest</a>';
	L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
	// L.tileLayer('https://{s}.tile.jawg.io/jawg-light/{z}/{x}/{y}{r}.png', {
	// L.tileLayer('https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png', {
	attribution: '&copy; '+mapLink+' Contributors &amp; '+translink,
	maxZoom: 18
}).addTo(map);

let g_clicked_node = null;

const kdeRenderer = new KDERenderer(map);
const treeRendererDonut = new TreeRenderer(d3.select("#treeContainerDonut"));
const treeRendererPie = new TreeRenderer(d3.select("#treeContainerPie"));
const treeRendererStreamgraphAbs = new TreeRenderer(d3.select("#treeContainerStreamgraphAbs"));
treeRendererStreamgraphAbs.streamgraph_options.use_relative_sizes = false;
const treeRendererStreamgraphRel = new TreeRenderer(d3.select("#treeContainerStreamgraphRel"));
treeRendererStreamgraphRel.streamgraph_options.use_relative_sizes = true;
const graphOptions = new GraphOptions();

const connection = new TTK.ttkWebSocketIO();
connection.on( 'messageSequence',  msgs=>{
  TTK.vtkDataSet.createFromMessageSequence(msgs).then( objects=>{
    console.log(objects[0]);
    treeRendererDonut.setVtkDataSet(objects[0]);
    treeRendererPie.setVtkDataSet(objects[0]);
    treeRendererStreamgraphAbs.setVtkDataSet(objects[0]);
    treeRendererStreamgraphRel.setVtkDataSet(objects[0]);
    treeRendererDonut.render("donut");
    treeRendererPie.render("pie");
    treeRendererStreamgraphAbs.render("streamgraph");
    treeRendererStreamgraphRel.render("streamgraph");
    graphOptions.setDonutGraph(treeRendererDonut);
    graphOptions.setPieGraph(treeRendererPie);
    graphOptions.setStreamGraphAbs(treeRendererStreamgraphAbs);
    graphOptions.setStreamGraphRel(treeRendererStreamgraphRel);
    graphOptions.render();
  });
});
connection.on('open',()=>connection.sendString('RequestInputVtkDataSet'));

connection.connect('localhost',9285);

const connection_map = new TTK.ttkWebSocketIO();
connection_map.on( 'messageSequence',  msgs=>{
  TTK.vtkDataSet.createFromMessageSequence(msgs).then( objects=>{
    console.log(objects[0]);
    kdeRenderer.setVtkDataSet(objects[0]);
    kdeRenderer.render(0.6, 2, 1);
    graphOptions.render();
  });
});
connection_map.on('open',()=>connection_map.sendString('RequestInputVtkDataSet'));

connection_map.connect('localhost',9286);
      </script>
   </body>
</html>
