<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>ttkWebSocketIO library examples</title>
    <script type="text/javascript" src="../WebSocketIO/ttkWebSocketIO.js"></script>
    <script type="text/javascript" src="./KDERenderer.js"></script>
    <script type="text/javascript" src="./TreeRenderer.js"></script>
    <script type="text/javascript" src="./GraphOptions.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.3.0/d3.min.js" integrity="sha512-NMhzM2RHzbCRO0s5VPaRC+2bW6nmNXimzC9p5sp2x19M+zzuSJ2T50dEQ7hpHkNjnX1mt8nQg1NNthwRZgsoIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r117/three.min.js"></script>

    <style>
      html {
        zoom: 1;
        font-family: Sans-Serif;
      }

      code {
        font-weight: bold;
        font-size: 1.1em;
      }

      textarea {
        box-sizing: border-box;
        display: block;
        width: 100%;
        font-family: "Lucida Console", Monaco, monospace;
        background-color: #efefef;
        padding: 0.5em;
        overflow: hidden;
      }

      li {
        margin: 0.5em 0em;
      }

    </style>
  </head>
    <body>

    <div>
      <div id="treeContainerDonut" style="float: left; width: 500px; height: 600px;margin:0 auto;"></div>
      <div id="treeContainerStreamgraph" style="float: left; width: 500px; height: 600px;margin:0 auto;"></div>
      <div id="mapContainer" style="width: 500px; height: 600px;margin:0 auto;"></div>
    </div>

    <div id="div_graph_options" style="float: left; width: 350px; height: 600px;margin:0 auto;">
      <input id="topN" type="range" min="1" max="6" value="3">
      <label id="label_topN" for="topN"></label>
      <br>
      <select id="color_scheme">
        <option value="schemeSet3">schemeSet3</option>
        <option value="schemePaired">schemePaired</option>
        <option value="schemeSet1">schemeSet1</option>
      </select>
      <br>
      <div id="color_legend" style="width: 100%">
        <label>Color Legend</label>
      </div>
      <div id="maxwidth_root" style="width: 100%">
        <input id="absolute_width" type="checkbox">
        <label id="label_absolute_width" for="absolute_width">absolute width?</label>
        <input id="maxwidthRoot" type="range" min="25" max="1000" value="3">
        <label id="label_maxwidthRoot" for="maxwidthRoot"></label>
      </div>
    </div>

      <script id='sourceCode'>
const map = L.map('mapContainer').setView([41.85003, -87.65005], 13);
const mapLink = '<a href="https://openstreetmap.org">OpenStreetMap</a>';
const translink = '<a href="http://thunderforest.com/">Thunderforest</a>';
	L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
	// L.tileLayer('https://{s}.tile.jawg.io/jawg-light/{z}/{x}/{y}{r}.png', {
	// L.tileLayer('https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png', {
	attribution: '&copy; '+mapLink+' Contributors &amp; '+translink,
	maxZoom: 18
}).addTo(map);

const kdeRenderer = new KDERenderer(map);
const treeRendererDonut = new TreeRenderer(d3.select("#treeContainerDonut"));
const treeRendererStreamgraph = new TreeRenderer(d3.select("#treeContainerStreamgraph"));
const graphOptions = new GraphOptions();

const connection = new TTK.ttkWebSocketIO();
connection.on( 'messageSequence',  msgs=>{
  TTK.vtkDataSet.createFromMessageSequence(msgs).then( objects=>{
    console.log(objects[0]);
    treeRendererDonut.setVtkDataSet(objects[0]);
    treeRendererStreamgraph.setVtkDataSet(objects[0]);
    treeRendererDonut.render("donut");
    treeRendererStreamgraph.render("streamgraph");
    graphOptions.setDonutGraph(treeRendererDonut);
    graphOptions.setStreamGraph(treeRendererStreamgraph);
    graphOptions.render();
  });
});
connection.on('open',()=>connection.sendString('RequestInputVtkDataSet'));

connection.connect('localhost',9285);

const connection_map = new TTK.ttkWebSocketIO();
connection_map.on( 'messageSequence',  msgs=>{
  TTK.vtkDataSet.createFromMessageSequence(msgs).then( objects=>{
    console.log(objects[0]);
    kdeRenderer.setVtkDataSet(objects[0]);
    kdeRenderer.render(0.5, 2, 1);
  });
});
connection_map.on('open',()=>connection_map.sendString('RequestInputVtkDataSet'));

connection_map.connect('localhost',9286);
      </script>
   </body>
</html>
