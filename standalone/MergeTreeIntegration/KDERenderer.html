<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>ttkWebSocketIO library examples</title>
    <script type="text/javascript" src="../WebSocketIO/ttkWebSocketIO.js"></script>
    <script type="text/javascript" src="./KDERenderer.js"></script>
    <script type="text/javascript" src="./TreeRenderer.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.3.0/d3.min.js" integrity="sha512-NMhzM2RHzbCRO0s5VPaRC+2bW6nmNXimzC9p5sp2x19M+zzuSJ2T50dEQ7hpHkNjnX1mt8nQg1NNthwRZgsoIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r117/three.min.js"></script>

    <style>
      html {
        zoom: 1;
        font-family: Sans-Serif;
      }

      code {
        font-weight: bold;
        font-size: 1.1em;
      }

      textarea {
        box-sizing: border-box;
        display: block;
        width: 100%;
        font-family: "Lucida Console", Monaco, monospace;
        background-color: #efefef;
        padding: 0.5em;
        overflow: hidden;
      }

      li {
        margin: 0.5em 0em;
      }

    </style>
  </head>
    <body>

    <div>
      <div id="treeContainerDonut" style="float: left; width: 600px; height: 600px;margin:0 auto;"></div>
      <div id="treeContainerStreamgraph" style="float: left; width: 600px; height: 600px;margin:0 auto;"></div>
    </div>
    <div id="mapContainer" style="width: 600px; height: 600px;margin:0 auto;"></div>

      <script id='sourceCode'>
const map = L.map('mapContainer').setView([41.85003, -87.65005], 13);
const mapLink = '<a href="https://openstreetmap.org">OpenStreetMap</a>';
const translink = '<a href="http://thunderforest.com/">Thunderforest</a>';
	L.tileLayer('https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png', {
	attribution: '&copy; '+mapLink+' Contributors &amp; '+translink,
	maxZoom: 18
}).addTo(map);

const kdeRenderer = new KDERenderer(map);
// const treeRendererDonut = new TreeRenderer($("#treeContainerDonut"));
const treeRendererDonut = new TreeRenderer(d3.select("#treeContainerDonut"));
const treeRendererStreamgraph = new TreeRenderer(d3.select("#treeContainerStreamgraph"));

const connection = new TTK.ttkWebSocketIO();
connection.on( 'messageSequence',  msgs=>{
  TTK.vtkDataSet.createFromMessageSequence(msgs).then( objects=>{
    console.log(objects[0]);
    treeRendererDonut.setVtkDataSet(objects[0]);
    treeRendererStreamgraph.setVtkDataSet(objects[0]);
    treeRendererDonut.render("donut");
    treeRendererStreamgraph.render("streamgraph");
  });
});
connection.on('open',()=>connection.sendString('RequestInputVtkDataSet'));

connection.connect('localhost',9285);
      </script>
   </body>
</html>
