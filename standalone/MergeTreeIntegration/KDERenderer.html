<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Donut And Streamgraphs</title>
    <script type="text/javascript" src="../WebSocketIO/ttkWebSocketIO.js"></script>
    <script type="text/javascript" src="./KDERenderer.js"></script>
    <script type="text/javascript" src="./TreeRenderer.js"></script>
    <script type="text/javascript" src="./GraphOptions.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="KDERenderer.css" />


    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.3.0/d3.min.js" integrity="sha512-NMhzM2RHzbCRO0s5VPaRC+2bW6nmNXimzC9p5sp2x19M+zzuSJ2T50dEQ7hpHkNjnX1mt8nQg1NNthwRZgsoIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r117/three.min.js"></script>
  </head>
    <body>

    <div class="container">
      <div class="row">
        <div class="col-4">
          <div id="mapContainer" class="row"></div>

          <div id="div_graph_options" class="row">
            <div class="col-6">
              <div class="row align-items-center px-1 pad-top-bottom">
                <label class="col-4">Top N Categories</label>
                <input id="topN" class="col-6" type="range" min="1" max="6" value="3">
                <label id="label_topN" class="col-2" for="topN"></label>
              </div>

              <div class="row align-items-center px-1 pad-top-bottom">
                <label class="col-4">Color Scheme</label>
                <select id="color_scheme" class="col">
                  <option value="schemeSet3">schemeSet3</option>
                  <option value="schemePaired">schemePaired</option>
                  <option value="schemeSet1">schemeSet1</option>
                </select>
              </div>

              <div class="row align-items-center px-1 pad-top-bottom">
                <label id="label_absolute_width" class="col-7" for="absolute_width">Absolute width?</label>
                <input id="absolute_width" class="col-3" type="checkbox">
              </div>

              <div class="row align-items-center px-1 pad-top-bottom">
                <label class="col-4">MaxWidth Root</label>
                <input id="maxwidthRoot" class="col-6" type="range" min="25" max="400" value="3">
                <label id="label_maxwidthRoot" class="col-2" for="maxwidthRoot"></label>
              </div>

              <div class="row align-items-center px-1 pad-top-bottom">
                <label class="col-4">No. of Contours</label>
                <input id="contour_count" class="col-6" type="range" min="1" max="10" value="3">
                <label id="label_contour_count" class="col-2" for="contour_count"></label>
              </div>
            </div>

            <div class="col-6">
              <div class="row align-items-center px-1">
                <div id="color_legend">
                  <h5>Color Legend</h5>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="graphContainer" class="col-8">
          <div class="row">
            <label class="col-2">Type</label>
            <div class="col-2"></div>
            <div class="col-8">
              <select id="graph_type">
                <option value="streamgraph">Streamgraph</option>
                <option value="donut">Donut</option>
              </select>
            </div>
          </div>
          <div id="graph" class="row">
            <div id="treeContainerDonut"></div>
            <div id="treeContainerStreamgraph"></div>
          </div>
        </div>
      </div>

    </div>

      <script id='sourceCode'>

d3.select("#graph_type").on("input", e => {
  if (e.target.value === "streamgraph") {
    d3.select("#treeContainerDonut").attr("style", "display: none");
    d3.select("#treeContainerStreamgraph").attr("style", "");
  }

  if (e.target.value === "donut") {
    d3.select("#treeContainerDonut").attr("style", "");
    d3.select("#treeContainerStreamgraph").attr("style", "display: none");
  }
});
d3.select("#graph_type").node().dispatchEvent(new Event("input"));

const map = L.map('mapContainer').setView([41.85003, -87.65005], 13);
const mapLink = '<a href="https://openstreetmap.org">OpenStreetMap</a>';
const translink = '<a href="http://thunderforest.com/">Thunderforest</a>';
	L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
	// L.tileLayer('https://{s}.tile.jawg.io/jawg-light/{z}/{x}/{y}{r}.png', {
	// L.tileLayer('https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png', {
	attribution: '&copy; '+mapLink+' Contributors &amp; '+translink,
	maxZoom: 18
}).addTo(map);

const kdeRenderer = new KDERenderer(map);
const treeRendererDonut = new TreeRenderer(d3.select("#treeContainerDonut"));
const treeRendererStreamgraph = new TreeRenderer(d3.select("#treeContainerStreamgraph"));
const graphOptions = new GraphOptions();

const connection = new TTK.ttkWebSocketIO();
connection.on( 'messageSequence',  msgs=>{
  TTK.vtkDataSet.createFromMessageSequence(msgs).then( objects=>{
    console.log(objects[0]);
    treeRendererDonut.setVtkDataSet(objects[0]);
    treeRendererStreamgraph.setVtkDataSet(objects[0]);
    treeRendererDonut.render("donut");
    treeRendererStreamgraph.render("streamgraph");
    graphOptions.setDonutGraph(treeRendererDonut);
    graphOptions.setStreamGraph(treeRendererStreamgraph);
    graphOptions.render();
  });
});
connection.on('open',()=>connection.sendString('RequestInputVtkDataSet'));

connection.connect('localhost',9285);

const connection_map = new TTK.ttkWebSocketIO();
connection_map.on( 'messageSequence',  msgs=>{
  TTK.vtkDataSet.createFromMessageSequence(msgs).then( objects=>{
    console.log(objects[0]);
    kdeRenderer.setVtkDataSet(objects[0]);
    kdeRenderer.render(0.5, 2, 1);
    graphOptions.render();
  });
});
connection_map.on('open',()=>connection_map.sendString('RequestInputVtkDataSet'));

connection_map.connect('localhost',9286);
      </script>
   </body>
</html>
